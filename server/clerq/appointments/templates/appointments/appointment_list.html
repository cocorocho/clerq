{% extends "dashboard.html" %}
{% load i18n %}

{% block dashboard-content %}
{{ block.super }}
<div class="w-full" hx-on::appointment-created="console.log('F')">
    <div class="overflow-x-auto pt-4">
        <table class="table table-pin-cols table-md table-fixed">
            <colgroup>
                <col class="w-1/4">
                <col class="w-1/4">
                <col class="w-1/4">
                <col class="w-1/4">
            </colgroup>

            <thead>
                <tr class="capitalize">
                    <th>
                        {% translate "client" %}
                    </th>
                    <th>
                        {% translate "time" %}
                    </th>
                    <th>
                        {% translate "appointed staff" %}
                    </th>
                    <th></th>
                </tr>
            </thead>
            <tbody hx-target="closest tr" hx-swap="outerHTML" hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
                {% for appointment in appointment_list %}
                <tr class="hover bg-current/50 transition duration-75">
                    <td class="truncate" title="{{ appointment.client_name }}">
                        {{ appointment.client_name }}
                    </td>
                    <td>
                        {{ appointment.appointment_time|time:"TIME_FORMAT" }}
                    </td>
                    <td class="truncate" title="{{ appointment.appointed_staff }}">
                        {{ appointment.appointed_staff }}
                    </td>
                    <td>
                        <div class="flex justify-end gap-x-1">
                            {% if perms.Appointments.change_appointment %}
                            <button type="button" class="btn btn-sm btn-warning capitalize px-1"
                                onclick="appointments_modal.showModal()"
                                hx-get="{% url 'appointments:appointment_update' pk=appointment.pk %}"
                                hx-target="#appointments_modal_content" hx-swap="innerHTML">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 256 256">
                                    <path fill="currentColor"
                                        d="M232.49 215.51L185 168a92.12 92.12 0 1 0-17 17l47.53 47.54a12 12 0 0 0 17-17ZM44 112a68 68 0 1 1 68 68a68.07 68.07 0 0 1-68-68Z" />
                                </svg>
                            </button>
                            {% endif %}

                            {% if perms.Appointments.delete_appointment %}
                            <button type="button" class="btn btn-sm btn-error capitalize px-1"
                                title="{% translate 'cancel appointment' %}"
                                hx-delete="{% url 'appointments:appointment_delete' pk=appointment.pk %}"
                                hx-confirm="{% translate 'cancel appointment' %}?">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                    <path fill="currentColor"
                                        d="M7 21q-.825 0-1.412-.587T5 19V6H4V4h5V3h6v1h5v2h-1v13q0 .825-.587 1.413T17 21H7Zm2-4h2V8H9v9Zm4 0h2V8h-2v9Z" />
                                </svg>
                            </button>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock dashboard-content %}